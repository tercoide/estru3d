<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - interactive cubes (gpu)</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
		<style>
			body {
				background-color: #fff;
				color: #444;
			}
			a {
				color: #08f;
			}
		</style>
	</head>
	<body>

		<div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> Estru3D WebGL Version 2
		</div>

		<div id="container"></div>



		<script type="module">

		// Variables globales?

		var effect, controls;

		// Pedido de origen cruzado bloqueado: La política de mismo origen no permite leer el recurso remoto
		// en file:///home/martin/node_modules/three/examples/build/three.module.js. (Razón: pedido CORS no es http).

		// Simplemente hacer referncia remota a las librerias.

			import * as THREE from 'https://threejs.org/build/three.module.js';

			import { OrbitControls } from 'https://threejs.org/examples/jsm/controls/OrbitControls.js';

			import { VRButton } from 'https://threejs.org/examples/jsm/webxr/VRButton.js';
			import { TubePainter } from 'https://threejs.org/examples/jsm/misc/TubePainter.js'
			import Stats from 'https://threejs.org/examples/jsm/libs/stats.module.js';

			import { TrackballControls } from 'https://threejs.org/examples/jsm/controls/TrackballControls.js';
			import { BufferGeometryUtils } from 'https://threejs.org/examples/jsm/utils/BufferGeometryUtils.js';

			var container, stats;
			var camera, controls, scene, renderer;
			var pickingData = [], pickingTexture, pickingScene;
			var highlightBox;


			var controller1, controller2;

			var cursor = new THREE.Vector3();

			var controls;

			var mouse = new THREE.Vector2();
			var offset = new THREE.Vector3( 10, 10, 10 );

			init();
			animate();

			function init() {

				// container = document.createElement( 'div' );
				// document.body.appendChild( container );

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0x222222 );

				camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.01, 50 );
				camera.position.set( 0, 1.6, 3 );

				controls = new OrbitControls( camera, container );
				controls.target.set( 0, 1.6, 0 );
				controls.update();

				var geometry = new THREE.BoxBufferGeometry( 0.5, 0.8, 0.5 );
				var material = new THREE.MeshStandardMaterial( {
					color: 0x444444,
					roughness: 1.0,
					metalness: 0.0
				} );
				var table = new THREE.Mesh( geometry, material );
				table.position.y = 0.35;
				table.position.z = 0.85;
				scene.add( table );

				var geometry = new THREE.PlaneBufferGeometry( 4, 4 );
				var material = new THREE.MeshStandardMaterial( {
					color: 0x222222,
					roughness: 1.0,
					metalness: 0.0
				} );
				var floor = new THREE.Mesh( geometry, material );
				floor.rotation.x = - Math.PI / 2;
				scene.add( floor );

				var grid = new THREE.GridHelper( 10, 20, 0x111111, 0x111111 );
				// grid.material.depthTest = false; // avoid z-fighting
				scene.add( grid );

				scene.add( new THREE.HemisphereLight( 0x888877, 0x777788 ) );

				var light = new THREE.DirectionalLight( 0xffffff, 0.5 );
				light.position.set( 0, 4, 0 );
				scene.add( light );

		//

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.outputEncoding = THREE.sRGBEncoding;
				renderer.xr.enabled = true;
				container.appendChild( renderer.domElement );


				//

				var painter1 = new TubePainter();
				scene.add( painter1.mesh );

				var painter2 = new TubePainter();
				scene.add( painter2.mesh );

				//


				document.body.appendChild( VRButton.createButton( renderer ) );

					// controllers

					function onSelectStart() {

						this.userData.isSelecting = true;

					}

					function onSelectEnd() {

						this.userData.isSelecting = false;

					}

					function onSequeezeStart() {

						this.userData.isSqueezing = true;
						this.userData.positionAtSqueezeStart = this.position.y;
						this.userData.scaleAtSqueezeStart = this.scale.x;

					}

					function onSqueezeEned() {

						this.userData.isSqueezing = false;

					}

					controller1 = renderer.xr.getController( 0 );
					controller1.addEventListener( 'selectstart', onSelectStart );
					controller1.addEventListener( 'selectend', onSelectEnd );
					controller1.addEventListener( 'squeezestart', onSequeezeStart );
					controller1.addEventListener( 'squeezeend', onSqueezeEned );
					controller1.userData.painter = painter1;
					scene.add( controller1 );

					controller2 = renderer.xr.getController( 1 );
					controller2.addEventListener( 'selectstart', onSelectStart );
					controller2.addEventListener( 'selectend', onSelectEnd );
					controller2.addEventListener( 'squeezestart', onSequeezeStart );
					controller2.addEventListener( 'squeezeend', onSqueezeEned );
					controller2.userData.painter = painter2;
					scene.add( controller2 );

					//




				pickingScene = new THREE.Scene();
				pickingTexture = new THREE.WebGLRenderTarget( 1, 1 );

				scene.add( new THREE.AmbientLight( 0x555555 ) );

				var light = new THREE.SpotLight( 0xffffff, 1.5 );
				light.position.set( 0, 500, 2000 );
				scene.add( light );

				var pickingMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } );
				var defaultMaterial = new THREE.MeshPhongMaterial( { color: 0xffffff, flatShading: true, vertexColors: true, shininess: 0	} );

				function applyVertexColors( geometry, color ) {

					var position = geometry.attributes.position;
					var colors = [];

					for ( var i = 0; i < position.count; i ++ ) {

						colors.push( color.r, color.g, color.b );

					}

					geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );

				} // init

									// intentare dibujar muchas lineas de un BufferGeometry
					 			// line material
					 			 // var material = new THREE.LineBasicMaterial({ color: 0x000fff });
				  			var material = new THREE.LineBasicMaterial({ vertexColors: true });// En vez de definir un color, usare un array de colores RGB

								var color = new THREE.Color();
				//				var colores = new Float32Array();
								var colores = [];

								var puntos = [];

								var vertices = [];
vertices = [ 0,0,0,0,0,0
,0.00,0.00,0.00,5.00,0.00,0.00
,5.00,0.00,0.00,10.00,0.00,0.00
,0.20,1.38,0.00,0.20,0.00,0.00
,0.22,0.14,0.00,0.20,0.00,0.00
,0.20,0.16,0.00,0.20,0.00,0.00
,0.20,0.14,0.02,0.20,0.00,0.00
,0.18,0.14,0.00,0.20,0.00,0.00
,0.20,0.11,0.00,0.20,0.00,0.00
,0.20,0.14,-0.02,0.20,0.00,0.00
,0.34,1.38,0.00,0.34,0.00,0.00
,0.37,0.14,0.00,0.34,0.00,0.00
,0.34,0.16,0.00,0.34,0.00,0.00
,0.34,0.14,0.02,0.34,0.00,0.00
,0.32,0.14,0.00,0.34,0.00,0.00
,0.34,0.11,0.00,0.34,0.00,0.00
,0.34,0.14,-0.02,0.34,0.00,0.00
,0.49,1.38,0.00,0.49,0.00,0.00
,0.51,0.14,0.00,0.49,0.00,0.00
,0.49,0.16,0.00,0.49,0.00,0.00
,0.49,0.14,0.02,0.49,0.00,0.00
,0.46,0.14,0.00,0.49,0.00,0.00
,0.49,0.11,0.00,0.49,0.00,0.00
,0.49,0.14,-0.02,0.49,0.00,0.00
,0.50,1.38,0.00,0.50,0.00,0.00
,0.52,0.14,0.00,0.50,0.00,0.00
,0.50,0.16,0.00,0.50,0.00,0.00
,0.50,0.14,0.02,0.50,0.00,0.00
,0.48,0.14,0.00,0.50,0.00,0.00
,0.50,0.11,0.00,0.50,0.00,0.00
,0.50,0.14,-0.02,0.50,0.00,0.00
,0.20,1.38,0.00,0.50,1.38,0.00
,0.75,1.38,0.00,0.75,0.00,0.00
,0.77,0.14,0.00,0.75,0.00,0.00
,0.75,0.16,0.00,0.75,0.00,0.00
,0.75,0.14,0.02,0.75,0.00,0.00
,0.73,0.14,0.00,0.75,0.00,0.00
,0.75,0.11,0.00,0.75,0.00,0.00
,0.75,0.14,-0.02,0.75,0.00,0.00
,5.25,1.38,0.00,5.25,0.00,0.00
,5.27,0.14,0.00,5.25,0.00,0.00
,5.25,0.16,0.00,5.25,0.00,0.00
,5.25,0.14,0.02,5.25,0.00,0.00
,5.23,0.14,0.00,5.25,0.00,0.00
,5.25,0.11,0.00,5.25,0.00,0.00
,5.25,0.14,-0.02,5.25,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.00,0.00,0.00,0.00,0.00,0.00
,0.14,-0.04,0.00,0.14,0.00,0.00
,0.14,-0.00,0.00,0.14,0.00,0.00
,0.14,-0.00,0.00,0.14,0.00,0.00
,0.14,-0.00,-0.00,0.14,0.00,0.00
,0.14,-0.00,0.00,0.14,0.00,0.00
,0.14,-0.00,0.00,0.14,0.00,0.00
,0.14,-0.00,0.00,0.14,0.00,0.00
,0.29,-0.08,0.00,0.29,0.00,0.00
,0.28,-0.01,0.00,0.29,0.00,0.00
,0.29,-0.01,0.00,0.29,0.00,0.00
,0.29,-0.01,-0.00,0.29,0.00,0.00
,0.29,-0.01,0.00,0.29,0.00,0.00
,0.29,-0.01,0.00,0.29,0.00,0.00
,0.29,-0.01,0.00,0.29,0.00,0.00
,0.43,-0.12,0.00,0.43,0.00,0.00
,0.43,-0.01,0.00,0.43,0.00,0.00
,0.43,-0.01,0.00,0.43,0.00,0.00
,0.43,-0.01,-0.00,0.43,0.00,0.00
,0.43,-0.01,0.00,0.43,0.00,0.00
,0.43,-0.01,0.00,0.43,0.00,0.00
,0.43,-0.01,0.00,0.43,0.00,0.00
,0.57,-0.16,0.00,0.57,0.00,0.00
,0.57,-0.02,0.00,0.57,0.00,0.00
,0.57,-0.02,0.00,0.57,0.00,0.00
,0.57,-0.02,-0.00,0.57,0.00,0.00
,0.57,-0.02,0.00,0.57,0.00,0.00
,0.57,-0.01,0.00,0.57,0.00,0.00
,0.57,-0.02,0.00,0.57,0.00,0.00
,0.71,-0.20,0.00,0.71,0.00,0.00
,0.71,-0.02,0.00,0.71,0.00,0.00
,0.71,-0.02,0.00,0.71,0.00,0.00
,0.71,-0.02,-0.00,0.71,0.00,0.00
,0.72,-0.02,0.00,0.71,0.00,0.00
,0.71,-0.02,0.00,0.71,0.00,0.00
,0.71,-0.02,0.00,0.71,0.00,0.00
,0.86,-0.24,0.00,0.86,0.00,0.00
,0.85,-0.02,0.00,0.86,0.00,0.00
,0.86,-0.03,0.00,0.86,0.00,0.00
,0.86,-0.02,-0.00,0.86,0.00,0.00
,0.86,-0.02,0.00,0.86,0.00,0.00
,0.86,-0.02,0.00,0.86,0.00,0.00
,0.86,-0.02,0.00,0.86,0.00,0.00
,1.00,-0.27,0.00,1.00,0.00,0.00
,1.00,-0.03,0.00,1.00,0.00,0.00
,1.00,-0.03,0.00,1.00,0.00,0.00
,1.00,-0.03,-0.00,1.00,0.00,0.00
,1.00,-0.03,0.00,1.00,0.00,0.00
,1.00,-0.02,0.00,1.00,0.00,0.00
,1.00,-0.03,0.00,1.00,0.00,0.00
,1.14,-0.31,0.00,1.14,0.00,0.00
,1.14,-0.03,0.00,1.14,0.00,0.00
,1.14,-0.04,0.00,1.14,0.00,0.00
,1.14,-0.03,-0.01,1.14,0.00,0.00
,1.15,-0.03,0.00,1.14,0.00,0.00
,1.14,-0.03,0.00,1.14,0.00,0.00
,1.14,-0.03,0.01,1.14,0.00,0.00
,1.29,-0.35,0.00,1.29,0.00,0.00
,1.28,-0.04,0.00,1.29,0.00,0.00
,1.29,-0.04,0.00,1.29,0.00,0.00
,1.29,-0.04,-0.01,1.29,0.00,0.00
,1.29,-0.04,0.00,1.29,0.00,0.00
,1.29,-0.03,0.00,1.29,0.00,0.00
,1.29,-0.04,0.01,1.29,0.00,0.00
,1.43,-0.39,0.00,1.43,0.00,0.00
,1.42,-0.04,0.00,1.43,0.00,0.00
,1.43,-0.05,0.00,1.43,0.00,0.00
,1.43,-0.04,-0.01,1.43,0.00,0.00
,1.44,-0.04,0.00,1.43,0.00,0.00
,1.43,-0.03,0.00,1.43,0.00,0.00
,1.43,-0.04,0.01,1.43,0.00,0.00
,1.57,-0.43,0.00,1.57,0.00,0.00
,1.56,-0.04,0.00,1.57,0.00,0.00
,1.57,-0.05,0.00,1.57,0.00,0.00
,1.57,-0.04,-0.01,1.57,0.00,0.00
,1.58,-0.04,0.00,1.57,0.00,0.00
,1.57,-0.04,0.00,1.57,0.00,0.00
,1.57,-0.04,0.01,1.57,0.00,0.00
,1.71,-0.47,0.00,1.71,0.00,0.00
,1.71,-0.05,0.00,1.71,0.00,0.00
,1.71,-0.05,0.00,1.71,0.00,0.00
,1.71,-0.05,-0.01,1.71,0.00,0.00
,1.72,-0.05,0.00,1.71,0.00,0.00
,1.71,-0.04,0.00,1.71,0.00,0.00
,1.71,-0.05,0.01,1.71,0.00,0.00
,1.86,-0.51,0.00,1.86,0.00,0.00
,1.85,-0.05,0.00,1.86,0.00,0.00
,1.86,-0.06,0.00,1.86,0.00,0.00
,1.86,-0.05,-0.01,1.86,0.00,0.00
,1.87,-0.05,0.00,1.86,0.00,0.00
,1.86,-0.04,0.00,1.86,0.00,0.00
,1.86,-0.05,0.01,1.86,0.00,0.00
,2.00,-0.55,0.00,2.00,0.00,0.00
,1.99,-0.05,0.00,2.00,0.00,0.00
,2.00,-0.06,0.00,2.00,0.00,0.00
,2.00,-0.05,-0.01,2.00,0.00,0.00
,2.01,-0.05,0.00,2.00,0.00,0.00
,2.00,-0.05,0.00,2.00,0.00,0.00
,2.00,-0.05,0.01,2.00,0.00,0.00
,2.14,-0.59,0.00,2.14,0.00,0.00
,2.13,-0.06,0.00,2.14,0.00,0.00
,2.14,-0.07,0.00,2.14,0.00,0.00
,2.14,-0.06,-0.01,2.14,0.00,0.00
,2.15,-0.06,0.00,2.14,0.00,0.00
,2.14,-0.05,0.00,2.14,0.00,0.00
,2.14,-0.06,0.01,2.14,0.00,0.00
,2.29,-0.63,0.00,2.29,0.00,0.00
,2.28,-0.06,0.00,2.29,0.00,0.00
,2.29,-0.07,0.00,2.29,0.00,0.00
,2.29,-0.06,-0.01,2.29,0.00,0.00
,2.30,-0.06,0.00,2.29,0.00,0.00
,2.29,-0.05,0.00,2.29,0.00,0.00
,2.29,-0.06,0.01,2.29,0.00,0.00
,2.43,-0.67,0.00,2.43,0.00,0.00
,2.42,-0.07,0.00,2.43,0.00,0.00
,2.43,-0.08,0.00,2.43,0.00,0.00
,2.43,-0.07,-0.01,2.43,0.00,0.00
,2.44,-0.07,0.00,2.43,0.00,0.00
,2.43,-0.06,0.00,2.43,0.00,0.00
,2.43,-0.07,0.01,2.43,0.00,0.00
,2.57,-0.71,0.00,2.57,0.00,0.00
,2.56,-0.07,0.00,2.57,0.00,0.00
,2.57,-0.08,0.00,2.57,0.00,0.00
,2.57,-0.07,-0.01,2.57,0.00,0.00
,2.58,-0.07,0.00,2.57,0.00,0.00
,2.57,-0.06,0.00,2.57,0.00,0.00
,2.57,-0.07,0.01,2.57,0.00,0.00
,2.71,-0.75,0.00,2.71,0.00,0.00
,2.70,-0.07,0.00,2.71,0.00,0.00
,2.71,-0.09,0.00,2.71,0.00,0.00
,2.71,-0.07,-0.01,2.71,0.00,0.00
,2.73,-0.07,0.00,2.71,0.00,0.00
,2.71,-0.06,0.00,2.71,0.00,0.00
,2.71,-0.07,0.01,2.71,0.00,0.00
,2.86,-0.79,0.00,2.86,0.00,0.00
,2.84,-0.08,0.00,2.86,0.00,0.00
,2.86,-0.09,0.00,2.86,0.00,0.00
,2.86,-0.08,-0.01,2.86,0.00,0.00
,2.87,-0.08,0.00,2.86,0.00,0.00
,2.86,-0.07,0.00,2.86,0.00,0.00
,2.86,-0.08,0.01,2.86,0.00,0.00
,3.00,-0.82,0.00,3.00,0.00,0.00
,2.99,-0.08,0.00,3.00,0.00,0.00
,3.00,-0.10,0.00,3.00,0.00,0.00
,3.00,-0.08,-0.01,3.00,0.00,0.00
,3.01,-0.08,0.00,3.00,0.00,0.00
,3.00,-0.07,0.00,3.00,0.00,0.00
,3.00,-0.08,0.01,3.00,0.00,0.00
,3.14,-0.86,0.00,3.14,0.00,0.00
,3.13,-0.09,0.00,3.14,0.00,0.00
,3.14,-0.10,0.00,3.14,0.00,0.00
,3.14,-0.09,-0.01,3.14,0.00,0.00
,3.16,-0.09,0.00,3.14,0.00,0.00
,3.14,-0.07,0.00,3.14,0.00,0.00
,3.14,-0.09,0.01,3.14,0.00,0.00
,3.29,-0.90,0.00,3.29,0.00,0.00
,3.27,-0.09,0.00,3.29,0.00,0.00
,3.29,-0.11,0.00,3.29,0.00,0.00
,3.29,-0.09,-0.02,3.29,0.00,0.00
,3.30,-0.09,0.00,3.29,0.00,0.00
,3.29,-0.08,0.00,3.29,0.00,0.00
,3.29,-0.09,0.02,3.29,0.00,0.00
,3.43,-0.94,0.00,3.43,0.00,0.00
,3.41,-0.09,0.00,3.43,0.00,0.00
,3.43,-0.11,0.00,3.43,0.00,0.00
,3.43,-0.09,-0.02,3.43,0.00,0.00
,3.44,-0.09,0.00,3.43,0.00,0.00
,3.43,-0.08,0.00,3.43,0.00,0.00
,3.43,-0.09,0.02,3.43,0.00,0.00
,3.57,-0.98,0.00,3.57,0.00,0.00
,3.56,-0.10,0.00,3.57,0.00,0.00
,3.57,-0.11,0.00,3.57,0.00,0.00
,3.57,-0.10,-0.02,3.57,0.00,0.00
,3.59,-0.10,0.00,3.57,0.00,0.00
,3.57,-0.08,0.00,3.57,0.00,0.00
,3.57,-0.10,0.02,3.57,0.00,0.00
,3.71,-1.02,0.00,3.71,0.00,0.00
,3.70,-0.10,0.00,3.71,0.00,0.00
,3.71,-0.12,0.00,3.71,0.00,0.00
,3.71,-0.10,-0.02,3.71,0.00,0.00
,3.73,-0.10,0.00,3.71,0.00,0.00
,3.71,-0.09,0.00,3.71,0.00,0.00
,3.71,-0.10,0.02,3.71,0.00,0.00
,3.86,-1.06,0.00,3.86,0.00,0.00
,3.84,-0.11,0.00,3.86,0.00,0.00
,3.86,-0.12,0.00,3.86,0.00,0.00
,3.86,-0.11,-0.02,3.86,0.00,0.00
,3.87,-0.11,0.00,3.86,0.00,0.00
,3.86,-0.09,0.00,3.86,0.00,0.00
,3.86,-0.11,0.02,3.86,0.00,0.00
,4.00,-1.10,0.00,4.00,0.00,0.00
,3.98,-0.11,0.00,4.00,0.00,0.00
,4.00,-0.13,0.00,4.00,0.00,0.00
,4.00,-0.11,-0.02,4.00,0.00,0.00
,4.02,-0.11,0.00,4.00,0.00,0.00
,4.00,-0.09,0.00,4.00,0.00,0.00
,4.00,-0.11,0.02,4.00,0.00,0.00
,4.14,-1.14,0.00,4.14,0.00,0.00
,4.12,-0.11,0.00,4.14,0.00,0.00
,4.14,-0.13,0.00,4.14,0.00,0.00
,4.14,-0.11,-0.02,4.14,0.00,0.00
,4.16,-0.11,0.00,4.14,0.00,0.00
,4.14,-0.09,0.00,4.14,0.00,0.00
,4.14,-0.11,0.02,4.14,0.00,0.00
,4.29,-1.18,0.00,4.29,0.00,0.00
,4.27,-0.12,0.00,4.29,0.00,0.00
,4.29,-0.14,0.00,4.29,0.00,0.00
,4.29,-0.12,-0.02,4.29,0.00,0.00
,4.31,-0.12,0.00,4.29,0.00,0.00
,4.29,-0.10,0.00,4.29,0.00,0.00
,4.29,-0.12,0.02,4.29,0.00,0.00
,4.43,-1.22,0.00,4.43,0.00,0.00
,4.41,-0.12,0.00,4.43,0.00,0.00
,4.43,-0.14,0.00,4.43,0.00,0.00
,4.43,-0.12,-0.02,4.43,0.00,0.00
,4.45,-0.12,0.00,4.43,0.00,0.00
,4.43,-0.10,0.00,4.43,0.00,0.00
,4.43,-0.12,0.02,4.43,0.00,0.00
,4.57,-1.26,0.00,4.57,0.00,0.00
,4.55,-0.13,0.00,4.57,0.00,0.00
,4.57,-0.15,0.00,4.57,0.00,0.00
,4.57,-0.13,-0.02,4.57,0.00,0.00
,4.59,-0.13,0.00,4.57,0.00,0.00
,4.57,-0.10,0.00,4.57,0.00,0.00
,4.57,-0.13,0.02,4.57,0.00,0.00
,4.71,-1.30,0.00,4.71,0.00,0.00
,4.69,-0.13,0.00,4.71,0.00,0.00
,4.71,-0.15,0.00,4.71,0.00,0.00
,4.71,-0.13,-0.02,4.71,0.00,0.00
,4.74,-0.13,0.00,4.71,0.00,0.00
,4.71,-0.11,0.00,4.71,0.00,0.00
,4.71,-0.13,0.02,4.71,0.00,0.00
,4.86,-1.34,0.00,4.86,0.00,0.00
,4.83,-0.13,0.00,4.86,0.00,0.00
,4.86,-0.16,0.00,4.86,0.00,0.00
,4.86,-0.13,-0.02,4.86,0.00,0.00
,4.88,-0.13,0.00,4.86,0.00,0.00
,4.86,-0.11,0.00,4.86,0.00,0.00
,4.86,-0.13,0.02,4.86,0.00,0.00
,5.00,-1.38,0.00,5.00,0.00,0.00
,4.98,-0.14,0.00,5.00,0.00,0.00
,5.00,-0.16,0.00,5.00,0.00,0.00
,5.00,-0.14,-0.02,5.00,0.00,0.00
,5.02,-0.14,0.00,5.00,0.00,0.00
,5.00,-0.11,0.00,5.00,0.00,0.00
,5.00,-0.14,0.02,5.00,0.00,0.00
,0.00,0.00,0.00,5.00,-1.38,0.00
,0.00,0.00,0.00,-0.46,-0.92,-0.46
,-0.46,-0.92,-0.46,0.46,-0.92,-0.46
,0.46,-0.92,-0.46,0.00,0.00,0.00
,0.46,-0.92,0.46,0.00,0.00,0.00
,0.46,-0.92,0.46,-0.46,-0.92,0.46
,-0.46,-0.92,0.46,0.00,0.00,0.00
,-0.46,-0.92,-0.46,-0.46,-0.92,0.46
,0.46,-0.92,-0.46,0.46,-0.92,0.46
,5.00,0.00,0.00,4.54,-0.92,-0.46
,4.54,-0.92,-0.46,5.46,-0.92,-0.46
,5.46,-0.92,-0.46,5.00,0.00,0.00
,5.00,0.00,0.00,5.46,-0.92,0.46
,5.46,-0.92,0.46,4.54,-0.92,0.46
,4.54,-0.92,0.46,5.00,0.00,0.00
,4.54,-0.92,-0.46,4.54,-0.92,0.46
,5.46,-0.92,-0.46,5.46,-0.92,0.46
,10.00,0.00,0.00,9.54,-0.92,-0.46
,9.54,-0.92,-0.46,10.46,-0.92,-0.46
,10.46,-0.92,-0.46,10.00,0.00,0.00
,10.00,0.00,0.00,10.46,-0.92,0.46
,10.46,-0.92,0.46,9.54,-0.92,0.46
,9.54,-0.92,0.46,10.00,0.00,0.00
,9.54,-0.92,-0.46,9.54,-0.92,0.46
,10.46,-0.92,-0.46,10.46,-0.92,0.46
 ];
colores = [ 0,0,0,0,0,0
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,0.00,1.00,0,0.00,1.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,0,1.00,0.00,0,1.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,1,0.00,0.00,1,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
,0,0.00,0.00,0,0.00,0.00
 ]; 
var geometry = new THREE.BufferGeometry();

geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));
geometry.setAttribute('color', new THREE.BufferAttribute(new Float32Array(colores), 3));

// aqui termina la creacion de lineas, que se insertan en la escena ahora
// que pasa si cda tramo tiene un color distinto?

var line = new THREE.LineSegments(geometry, material);
scene.add(line);

// Cubes

var geometriesDrawn = [];
var geometriesPicking = [];


var matrix = new THREE.Matrix4();
var quaternion = new THREE.Quaternion();
var color = new THREE.Color();

for ( var i = 0; i < 50; i ++ ) {

  var geometry = new THREE.BoxBufferGeometry();

  var position = new THREE.Vector3();
  position.x = Math.random() * 10000 - 5000;
  position.y = Math.random() * 6000 - 3000;
  position.z = Math.random() * 8000 - 4000;

  var rotation = new THREE.Euler();
  rotation.x = Math.random() * 2 * Math.PI;
  rotation.y = Math.random() * 2 * Math.PI;
  rotation.z = Math.random() * 2 * Math.PI;

  var scale = new THREE.Vector3();
  scale.x = Math.random() * 200 + 100;
  scale.y = Math.random() * 200 + 100;
  scale.z = Math.random() * 200 + 100;

  quaternion.setFromEuler( rotation );
  matrix.compose( position, quaternion, scale );

  geometry.applyMatrix4( matrix );

  // give the geometry's vertices a random color, to be displayed

  applyVertexColors( geometry, color.setHex( Math.random() * 0xffffff ) );

  geometriesDrawn.push( geometry );

  geometry = geometry.clone(); // Para poder seleccionar los cubos

  // give the geometry's vertices a color corresponding to the "id"

  applyVertexColors( geometry, color.setHex( i ) );

  geometriesPicking.push( geometry );

  pickingData[ i ] = {

    position: position,
    rotation: rotation,
    scale: scale

  }; // Picking

} // Cubes

// aqui termina la creacion de objetos, que se insertan en la escena ahora
var objects = new THREE.Mesh( BufferGeometryUtils.mergeBufferGeometries( geometriesDrawn ), defaultMaterial );
scene.add( objects );

pickingScene.add( new THREE.Mesh( BufferGeometryUtils.mergeBufferGeometries( geometriesPicking ), pickingMaterial ) );

highlightBox = new THREE.Mesh(
  new THREE.BoxBufferGeometry(),
  new THREE.MeshLambertMaterial( { color: 0xffff00 }
  ) );
scene.add( highlightBox );

renderer = new THREE.WebGLRenderer( { antialias: true } );
renderer.setPixelRatio( window.devicePixelRatio );
renderer.setSize( window.innerWidth, window.innerHeight );
container.appendChild( renderer.domElement );

controls = new TrackballControls( camera, renderer.domElement );
controls.rotateSpeed = 1.0;
controls.zoomSpeed = 1.2;
controls.panSpeed = 0.8;
controls.noZoom = false;
controls.noPan = false;
controls.staticMoving = true;
controls.dynamicDampingFactor = 0.3;


// Show FPS
stats = new Stats();
container.appendChild( stats.dom );

renderer.domElement.addEventListener( 'mousemove', onMouseMove );

}

//

function onMouseMove( e ) {

mouse.x = e.clientX;
mouse.y = e.clientY;

}

function animate() {

requestAnimationFrame( animate );

render();
stats.update();

}

function pick() {

//render the picking scene off-screen

// set the view offset to represent just a single pixel under the mouse

camera.setViewOffset( renderer.domElement.width, renderer.domElement.height, mouse.x * window.devicePixelRatio | 0, mouse.y * window.devicePixelRatio | 0, 1, 1 );

// render the scene

renderer.setRenderTarget( pickingTexture );
renderer.render( pickingScene, camera );

// clear the view offset so rendering returns to normal

camera.clearViewOffset();

//create buffer for reading single pixel

var pixelBuffer = new Uint8Array( 4 );

//read the pixel

renderer.readRenderTargetPixels( pickingTexture, 0, 0, 1, 1, pixelBuffer );

//interpret the pixel as an ID

var id = ( pixelBuffer[ 0 ] << 16 ) | ( pixelBuffer[ 1 ] << 8 ) | ( pixelBuffer[ 2 ] );
var data = pickingData[ id ];

if ( data ) {

  //move our highlightBox so that it surrounds the picked object

  if ( data.position && data.rotation && data.scale ) {

    highlightBox.position.copy( data.position );
    highlightBox.rotation.copy( data.rotation );
    highlightBox.scale.copy( data.scale ).add( offset );
    highlightBox.visible = true;

  }

} else {

  highlightBox.visible = false;

}

}

function render() {

controls.update();

pick();

renderer.setRenderTarget( null );
renderer.render( scene, camera );

}

</script>

</body>
</html>
