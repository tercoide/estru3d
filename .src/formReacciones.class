' Gambas class file

'
' estru3D
' Software para cálculo de estructuras mediante el método de la rigidez. Calcula estructuras tridimensionales, representa esfuerzos y solicitaciones en apoyos. Gráficas elásticas.
'
' Copyright (C) Ing Martin P Cristia
'
' This program is free software; you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation; either version 2 of the License, or
' (at your option) any later version.
'
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License
' along with this program; if not, write to the Free Software
' Foundation, Inc., 51 Franklin St, Fifth Floor,
' Boston, MA  02110-1301  USA
'

Public Sub Form_open()

    RellenaDatos()

    cargacombobox()
    ComboBoxFormato.text = "0.00E00"




End Sub



Public Sub aceptar2_Click()


    
    formReacciones.Close

End


Public Sub ButtonCopiaPortapapeles_Click() ''el contenido del formulario lo paso al portapapeles

    modUtils.copiaraportapapeles(grdreacciones)


End


Private Sub cargacombobox()

    comboboxformato.clear()
    ComboBoxFormato.Add("0.00E00")
    ComboBoxFormato.Add("0.00")
    ComboBoxFormato.Add("0.0000")
    ComboBoxFormato.Add(modestru.setting.formato_datos)
    ComboBoxFormato.ReadOnly = True

End


Public Sub ComboBoxFormato_Click()

    modestru.setting.formato = comboboxformato.text
    RellenaDatos()

End

Private Sub RellenaDatos()
    ' no esta del todo preparado para porticos espaciales

    Dim a As Integer, sMat As String
    Dim b As Integer, gl1 As Integer
    Dim ah As Integer, nn As Integer, nn2 As Integer

    gl1 = modcalculus.gr

    With modEstru
        'logear "Abriendo Reacciones"
        grdreacciones.Columns.Count = 10
        grdreacciones.Rows.Count = .apoyos.Count 
        grdreacciones.Columns[0].Title = "Nº"
        grdreacciones.Columns[1].title = "X"
        grdreacciones.Columns[2].title = "Y"
        grdreacciones.Columns[3].title = "Z"
        grdreacciones.Columns[4].title = "Rx"
        grdreacciones.Columns[5].title = "Ry"
        grdreacciones.Columns[6].title = "Rz"
        grdreacciones.Columns[7].title = "Mx"
        grdreacciones.Columns[8].title = "My"
        grdreacciones.Columns[9].title = "Mz"

        ah = 0
        For a = 0 To .apoyos.max
            
           

            ah = .apoyos[a].nudo
            grdreacciones[a, 0].text = Str$(.apoyos[a].nudo)
            grdreacciones[a, 1].text = Format(.nudo[ah].x, .setting.formato_datos)
            grdreacciones[a, 2].text = Format(.nudo[ah].Y, .setting.formato_datos)
            grdreacciones[a, 3].text = Format(.nudo[ah].z, .setting.formato_datos)
           

            Select Case .datos.tipo
                Case .reticuladoplano
                    grdreacciones[a, 4].text = Format(.apoyos[a].ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(.apoyos[a].ReacFy, .setting.formato)
                Case .porticoplano
                    grdreacciones[a, 4].text = Format(.apoyos[a].ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(.apoyos[a].ReacFy, .setting.formato)
                    grdreacciones[a, 9].text = Format(.apoyos[a].ReacMz, .setting.formato)
                Case .reticuladoespacial
                    grdreacciones[a, 4].text = Format(.apoyos[a].ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(.apoyos[a].ReacFy, .setting.formato)
                    grdreacciones[a, 6].text = Format(.apoyos[a].ReacFz, .setting.formato)
                Case .porticoespacial

                    grdreacciones[a, 4].text = Format(.apoyos[a].ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(.apoyos[a].ReacFy, .setting.formato)
                    grdreacciones[a, 6].text = Format(.apoyos[a].ReacFz, .setting.formato)
                    
                    grdreacciones[a, 7].text = Format(.apoyos[a].ReacMx, .setting.formato)
                    grdreacciones[a, 8].text = Format(.apoyos[a].ReacMy, .setting.formato)
                    grdreacciones[a, 9].text = Format(.apoyos[a].ReacMz, .setting.formato)

            End Select



        Next

    End With

End



