' Gambas class file

'
' estru3D
' Software para cálculo de estructuras mediante el método de la rigidez. Calcula estructuras tridimensionales, representa esfuerzos y solicitaciones en apoyos. Gráficas elásticas.
'
' Copyright (C) Ing Martin P Cristia
'
' This program is free software; you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation; either version 2 of the License, or
' (at your option) any later version.
'
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License
' along with this program; if not, write to the Free Software
' Foundation, Inc., 51 Franklin St, Fifth Floor,
' Boston, MA  02110-1301  USA
'

Public Sub Form_open()

    RellenaDatos()

    cargacombobox()
    ComboBoxFormato.text = "0.00E00"

End Sub

Public Sub aceptar2_Click()

    formReacciones.Close

End

Public Sub ButtonCopiaPortapapeles_Click() ''el contenido del formulario lo paso al portapapeles

    modUtils.copiaraportapapeles(grdreacciones)

End

Private Sub cargacombobox()

    comboboxformato.clear()
    ComboBoxFormato.Add("0.00E00")
    ComboBoxFormato.Add("0.00")
    ComboBoxFormato.Add("0.0000")
    ComboBoxFormato.Add(modestru.setting.formato_datos)
    ComboBoxFormato.ReadOnly = True

End

Public Sub ComboBoxFormato_Click()

    modestru.setting.formato = comboboxformato.text
    RellenaDatos()

End

Private Sub RellenaDatos()
    ' no esta del todo preparado para porticos espaciales

    Dim a As Integer

    With modEstru
        'logear "Abriendo Reacciones"
        grdreacciones.Columns.Count = 10

        grdreacciones.Columns[0].Title = "Nº"
        grdreacciones.Columns[1].title = "X"
        grdreacciones.Columns[2].title = "Y"
        grdreacciones.Columns[3].title = "Z"
        grdreacciones.Columns[4].title = "Rx"
        grdreacciones.Columns[5].title = "Ry"
        grdreacciones.Columns[6].title = "Rz"
        grdreacciones.Columns[7].title = "Mx"
        grdreacciones.Columns[8].title = "My"
        grdreacciones.Columns[9].title = "Mz"

        a = 0
        For Each nudo1 As ClsNudo In .nudo
            If IsNull(nudo1.apoyo) Then Continue

            grdreacciones.Rows.Count += 1

            grdreacciones[a, 0].text = Str$(nudo1.indice)
            grdreacciones[a, 1].text = Format(nudo1.x, .setting.formato_datos)
            grdreacciones[a, 2].text = Format(nudo1.Y, .setting.formato_datos)
            grdreacciones[a, 3].text = Format(nudo1.z, .setting.formato_datos)

            Select Case .datos.tipo
                Case .reticuladoplano
                    grdreacciones[a, 4].text = Format(nudo1.apoyo.ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(nudo1.apoyo.ReacFy, .setting.formato)
                Case .porticoplano
                    grdreacciones[a, 4].text = Format(nudo1.apoyo.ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(nudo1.apoyo.ReacFy, .setting.formato)
                    grdreacciones[a, 9].text = Format(nudo1.apoyo.ReacMz, .setting.formato)
                Case .reticuladoespacial
                    grdreacciones[a, 4].text = Format(nudo1.apoyo.ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(nudo1.apoyo.ReacFy, .setting.formato)
                    grdreacciones[a, 6].text = Format(nudo1.apoyo.ReacFz, .setting.formato)
                Case .porticoespacial

                    grdreacciones[a, 4].text = Format(nudo1.apoyo.ReacFx, .setting.formato)
                    grdreacciones[a, 5].text = Format(nudo1.apoyo.ReacFy, .setting.formato)
                    grdreacciones[a, 6].text = Format(nudo1.apoyo.ReacFz, .setting.formato)

                    grdreacciones[a, 7].text = Format(nudo1.apoyo.ReacMx, .setting.formato)
                    grdreacciones[a, 8].text = Format(nudo1.apoyo.ReacMy, .setting.formato)
                    grdreacciones[a, 9].text = Format(nudo1.apoyo.ReacMz, .setting.formato)

            End Select
            Inc a

        Next

    End With

End
