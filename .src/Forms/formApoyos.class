' Gambas class file

'
' estru3D
' Software para cálculo de estructuras mediante el método de la rigidez. Calcula estructuras tridimensionales, representa esfuerzos y solicitaciones en apoyos. Gráficas elásticas.
'
' Copyright (C) Ing Martin P Cristia
'
' This program is free software; you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation; either version 2 of the License, or
' (at your option) any later version.
'
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License
' along with this program; if not, write to the Free Software
' Foundation, Inc., 51 Franklin St, Fifth Floor,
' Boston, MA  02110-1301  USA
'

Public notocar As Boolean

Public Sub Form_Open()

    Dim a As Integer

    Me.Title = Application.Name & " " & ("Tabla de Apoyos")

    LabelUnidadesMedida.text = modestru.EscribeUnidadesDeMedida()

    With tblParam
        .header = GridView.Both
        .rows.count = 6
        .columns.count = 4
        .Rows[0].Title = "  X  "
        .Rows[1].Title = "  Y  "
        .Rows[2].Title = "  Z  "
        .Rows[3].Title = "  Gx "
        .Rows[4].Title = "  Gy "
        .Rows[5].Title = "  Gz "

        .Columns[0].title = ("Impide     ")
        .Columns[1].title = ("Movimiento ")
        .Columns[2].title = ("Elongacion ")
        .Columns[3].title = ("Cedim elast")

        .Columns[0].width = 100
        .Columns[1].width = 100
        .Columns[2].width = 100
        .Columns[3].width = 100

        '.font.name = "Times"
        '.font.size = 9
        '.Background = 16777215
        '.Foreground = 0
    End With

    With tblApoyo
        .header = GridView.Horizontal
        .rows.count = 0
        .columns.count = 2

        .Columns[0].title = ("Apoyo")
        .Columns[1].title = ("Nudo")

        .Columns[0].width = 80
        .Columns[1].width = 80

        '.font.name = "Times"
        '.font.size = 9
        '.Background = 16777215
        '.Foreground = 0
    End With
    llenarListaApoyos

    llenarParametros

End Sub

Public Sub btnAdd_Click()

    ' agrego un apoyo
    Dim n As ClsNudo, r As String

    r = InputBox(("Numero de nudo"), ("Agregar apoyo"), "1")
    If IsNull(r) Then Return ' pulso Cancelar

    Try n = modestru.nudo[r]

    If IsNull(n) Then Message(("Nudo equivocado"))

    tblApoyo.Rows.Count += 1

    n.apoyo = New ClsApoyo

    tblApoyo[tblApoyo.Rows.max, 0].Text = Str$(tblApoyo.Rows.Count)
    tblApoyo[tblapoyo.rows.max, 1].Text = Str(n.handle)

End

Sub llenarListaApoyos()

    Dim a As Integer

    tblApoyo.Rows.Count = 0
    For Each n As ClsNudo In modestru.nudo

        If Not IsNull(n.apoyo) Then
            tblApoyo.Rows.Count += 1
            tblApoyo[tblApoyo.Rows.Count - 1, 0].Text = Str(tblApoyo.Rows.Count)
            tblApoyo[tblApoyo.Rows.Count - 1, 1].Text = n.handle
        End If
    Next
    If tblApoyo.Rows.Count > 0 Then tblApoyo.Row = 0

End

Private Function ponicono(numero As Integer) As Picture
    'devuelvo el picture ok o cancel, segun el valor de numero

    Select Case numero
        Case 1
            Return Picture["00_1.png"]
        Case 0

            Return Picture["00_-1.png"]
    End Select

End

Private Sub pongoIcono()
    'pongo icono en la 1º columna "movimientos impedidos"

    Try tblParam[0, 0].Picture = ponicono(tblParam[0, 0].Text)
    Try tblParam[1, 0].Picture = ponicono(tblParam[1, 0].Text)
    Try tblParam[2, 0].Picture = ponicono(tblParam[2, 0].Text)
    Try tblParam[3, 0].Picture = ponicono(tblParam[3, 0].Text)
    Try tblParam[4, 0].Picture = ponicono(tblParam[4, 0].Text)
    Try tblParam[5, 0].Picture = ponicono(tblParam[5, 0].Text)

    If Error Then
        'se ha intentado poner un icono y no se ha podido"
    Endif

End

Sub llenarParametros()

    Dim a As Integer, n As ClsNudo

    If tblapoyo.row < 0 Then Return
    n = modestru.nudo[tblApoyo[tblapoyo.row, 1].Text]
    ' uso el apoyos(0) que esta siempre vacio para limpiar
    If IsNull(n.apoyo) Then Return
    tblparam.Tag = n
    tblParam[0, 0].Text = n.apoyo.rx
    tblParam[1, 0].Text = n.apoyo.ry
    tblParam[2, 0].Text = n.apoyo.rz
    tblParam[3, 0].Text = n.apoyo.rmx
    tblParam[4, 0].Text = n.apoyo.rmy
    tblParam[5, 0].Text = n.apoyo.rmz

    pongoIcono()

    tblParam[0, 3].Text = n.apoyo.cex
    tblParam[1, 3].Text = n.apoyo.cey
    tblParam[2, 3].Text = n.apoyo.cez
    tblParam[3, 3].Text = n.apoyo.cefix
    tblParam[4, 3].Text = n.apoyo.cefiy
    tblParam[5, 3].Text = n.apoyo.cefiz
    tblParam[0, 2].Text = n.apoyo.ex
    tblParam[1, 2].Text = n.apoyo.ey
    tblParam[2, 2].Text = n.apoyo.ez
    tblParam[3, 2].Text = n.apoyo.efix
    tblParam[4, 2].Text = n.apoyo.efiy
    tblParam[5, 2].Text = n.apoyo.efiz
    tblParam[0, 1].Text = n.apoyo.mx
    tblParam[1, 1].Text = n.apoyo.My
    tblParam[2, 1].Text = n.apoyo.Mz
    tblParam[3, 1].Text = n.apoyo.mfix
    tblParam[4, 1].Text = n.apoyo.mfiy
    tblParam[5, 1].Text = n.apoyo.mfiz

End

Public Sub btnCerrar_Click()

    tblParam.Cancel
    tblApoyo.Cancel
    GuardarCambios

    Me.Close

End

Sub GuardarCambios()

    Dim n As ClsNudo

    If tblapoyo.row < 0 Then Return
    n = modestru.nudo[tblApoyo[tblapoyo.row, 1].Text]

    If IsNull(n.apoyo) Then n.apoyo = New ClsApoyo

    n.apoyo.rx = modutils.cpval(tblParam[0, 0].Text)
    n.apoyo.ry = modutils.cpval(tblParam[1, 0].Text)
    n.apoyo.rz = modutils.cpval(tblParam[2, 0].Text)
    n.apoyo.rmx = modutils.cpval(tblParam[3, 0].Text)
    n.apoyo.rmy = modutils.cpval(tblParam[4, 0].Text)
    n.apoyo.rmz = modutils.cpval(tblParam[5, 0].Text)
    n.apoyo.cex = modutils.cpval(tblParam[0, 3].Text)
    n.apoyo.cey = modutils.cpval(tblParam[1, 3].Text)
    n.apoyo.cez = modutils.cpval(tblParam[2, 3].Text)
    n.apoyo.cefix = modutils.cpval(tblParam[3, 3].Text)
    n.apoyo.cefiy = modutils.cpval(tblParam[4, 3].Text)
    n.apoyo.cefiz = modutils.cpval(tblParam[5, 3].Text)
    n.apoyo.ex = modutils.cpval(tblParam[0, 2].Text)
    n.apoyo.ey = modutils.cpval(tblParam[1, 2].Text)
    n.apoyo.ez = modutils.cpval(tblParam[2, 2].Text)
    n.apoyo.efix = modutils.cpval(tblParam[3, 2].Text)
    n.apoyo.efiy = modutils.cpval(tblParam[4, 2].Text)
    n.apoyo.efiz = modutils.cpval(tblParam[5, 2].Text)
    n.apoyo.mx = modutils.cpval(tblParam[0, 1].Text)
    n.apoyo.My = modutils.cpval(tblParam[1, 1].Text)
    n.apoyo.Mz = modutils.cpval(tblParam[2, 1].Text)
    n.apoyo.mfix = modutils.cpval(tblParam[3, 1].Text)
    n.apoyo.mfiy = modutils.cpval(tblParam[4, 1].Text)
    n.apoyo.mfiz = modutils.cpval(tblParam[5, 1].Text)

End

Public Sub tblApoyo_Click()

    llenarParametros

End

Public Sub tblParam_Click()

    tblParam.Edit

End

Public Sub tblParam_Save(fila As Integer, col As Integer, valor As String)

    If IsNull(valor) Then valor = "0"

    If col = 0 Then

        tblParam[fila, col].Text = Format(modutils.cpval(valor), "0")
    Else

        tblParam[fila, col].Text = Format(modUtils.CPval(valor), modestru.setting.formato_datos)
    Endif
    pongoIcono()

End

Public Sub tblparam_LostFocus()

    If tblparam.Row >= 0 And tblparam.Column >= 0 Then
        tblParam_Save(tblparam.Row, tblparam.Column, tblparam[tblparam.Row, tblparam.Column].Text)
    Endif

End

Public Sub btnApFijo_Click()

    tblParam[0, 0].Text = 1
    tblParam[1, 0].Text = 1
    tblParam[2, 0].Text = 1
    tblParam[3, 0].Text = 0
    tblParam[4, 0].Text = 0
    tblParam[5, 0].Text = 0
    tblParam[0, 3].Text = 0
    tblParam[1, 3].Text = 0
    tblParam[2, 3].Text = 0
    tblParam[3, 3].Text = 0
    tblParam[4, 3].Text = 0
    tblParam[5, 3].Text = 0
    tblParam[0, 2].Text = 0
    tblParam[1, 2].Text = 0
    tblParam[2, 2].Text = 0
    tblParam[3, 2].Text = 0
    tblParam[4, 2].Text = 0
    tblParam[5, 2].Text = 0
    tblParam[0, 1].Text = 0
    tblParam[1, 1].Text = 0
    tblParam[2, 1].Text = 0
    tblParam[3, 1].Text = 0
    tblParam[4, 1].Text = 0
    tblParam[5, 1].Text = 0

    pongoIcono()

End

Public Sub btnApFijo2_Click()

    tblParam[0, 0].Text = 0
    tblParam[1, 0].Text = 0
    tblParam[2, 0].Text = 1
    tblParam[3, 0].Text = 0
    tblParam[4, 0].Text = 0
    tblParam[5, 0].Text = 0
    tblParam[0, 3].Text = 0
    tblParam[1, 3].Text = 0
    tblParam[2, 3].Text = 0
    tblParam[3, 3].Text = 0
    tblParam[4, 3].Text = 0
    tblParam[5, 3].Text = 0
    tblParam[0, 2].Text = 0
    tblParam[1, 2].Text = 0
    tblParam[2, 2].Text = 0
    tblParam[3, 2].Text = 0
    tblParam[4, 2].Text = 0
    tblParam[5, 2].Text = 0
    tblParam[0, 1].Text = 0
    tblParam[1, 1].Text = 0
    tblParam[2, 1].Text = 0
    tblParam[3, 1].Text = 0
    tblParam[4, 1].Text = 0
    tblParam[5, 1].Text = 0

    pongoIcono()

End

Public Sub btnApFijo3_Click()

    tblParam[0, 0].Text = 0
    tblParam[1, 0].Text = 1
    tblParam[2, 0].Text = 1
    tblParam[3, 0].Text = 0
    tblParam[4, 0].Text = 0
    tblParam[5, 0].Text = 0
    tblParam[0, 3].Text = 0
    tblParam[1, 3].Text = 0
    tblParam[2, 3].Text = 0
    tblParam[3, 3].Text = 0
    tblParam[4, 3].Text = 0
    tblParam[5, 3].Text = 0
    tblParam[0, 2].Text = 0
    tblParam[1, 2].Text = 0
    tblParam[2, 2].Text = 0
    tblParam[3, 2].Text = 0
    tblParam[4, 2].Text = 0
    tblParam[5, 2].Text = 0
    tblParam[0, 1].Text = 0
    tblParam[1, 1].Text = 0
    tblParam[2, 1].Text = 0
    tblParam[3, 1].Text = 0
    tblParam[4, 1].Text = 0
    tblParam[5, 1].Text = 0

    pongoIcono()

End

Public Sub btnApFijo4_Click()

    tblParam[0, 0].Text = 1
    tblParam[1, 0].Text = 1
    tblParam[2, 0].Text = 1
    tblParam[3, 0].Text = 1
    tblParam[4, 0].Text = 1
    tblParam[5, 0].Text = 1
    tblParam[0, 3].Text = 0
    tblParam[1, 3].Text = 0
    tblParam[2, 3].Text = 0
    tblParam[3, 3].Text = 0
    tblParam[4, 3].Text = 0
    tblParam[5, 3].Text = 0
    tblParam[0, 2].Text = 0
    tblParam[1, 2].Text = 0
    tblParam[2, 2].Text = 0
    tblParam[3, 2].Text = 0
    tblParam[4, 2].Text = 0
    tblParam[5, 2].Text = 0
    tblParam[0, 1].Text = 0
    tblParam[1, 1].Text = 0
    tblParam[2, 1].Text = 0
    tblParam[3, 1].Text = 0
    tblParam[4, 1].Text = 0
    tblParam[5, 1].Text = 0

    pongoIcono()

End

Public Sub btnDelete_Click()

    If tblApoyo.Rows.Count = 0 Then Return
    If tblApoyo.Row < 0 Then Return

    Dim n As ClsNudo

    If tblapoyo.row < 0 Then Return
    n = modestru.nudo[tblApoyo[tblapoyo.row, 1].Text]
    ' uso el apoyos(0) que esta siempre vacio para limpiar
    n.apoyo = Null

    llenarListaApoyos
    llenarParametros

End

Public Sub Button1_Click()

    GuardarCambios

End
